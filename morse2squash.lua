#!/usr/bin/env luajit
require"ccrypt"
-- https://de.wikipedia.org/wiki/Kurier_(Verfahren)
-- 10 dit 110 dah 00 character 000 word
local morse={
	[" "]="0", 		["A"]="1011",		["B"]="11010101",	["C"]="110101101",	["D"]="110101",	
	["E"]="1",		["F"]="10101101",	["G"]="1101101",	["H"]="1010101",	["I"]="101",	
	["J"]="1011011011",	["K"]="1101011",	["L"]="10110101",	["M"]="11011",		["N"]="1101",	
	["O"]="11011011",	["P"]="101101101",	["Q"]="1101101011",	["R"]="101101",	["S"]="10101",
	["T"]="11",		["U"]="101011",	["V"]="10101011",	["W"]="1011011",	["X"]="110101011",
	["Y"]="1101011011",	["Z"]="110110101",	["0"]="11011011011011",	["1"]="1011011011011",	["2"]="101011011011",
	["3"]="10101011011",	["4"]="1010101011",	["5"]="101010101",	["6"]="1101010101",	["7"]="11011010101",
	["8"]="110110110101",	["9"]="1101101101101",	["."]="10110101101011",	[","]="110110101011011",	["?"]="1010110110101",	
	["'"]="101101101101101",	["!"]="110101101011011",	["/"]="11010101101",	["("]="110101101101",	[")"]="110101101101011",	
	["&"]="1011010101",	[":"]="11011011010101",	[";"]="11010110101101",	["="]="11010101011",	["+"]="10110101101",	
	["-"]="1101010101011",	["_"]="10101101101011",	["\""]="1011010101101",["$"]="101010110101011",["@"]="10110110101101",	
	["CH"]="11011011011",	["[SOS]"]="10101011011011010101",["[SMS]"]="10101011011010101",
	["+"]="1010101101011",["[ERR]"]="1010101010101",
	["[KA]"]="110101101011",	["\f"]="10110101101",["[VE]"]="1010101101",["[AS]"]="1011010101",
	--[""]="",
}
local imorse={} for k,v in pairs(morse) do imorse[v]=k end
function string.morse(text)
	local t={}
	for c in text:utf8all() do
		local m=morse[c]
		if m then 
			t[#t+1]=m
			if m~="0" then
				t[#t+1]="00"
			end
		end
	end
	return table.concat(t)
end
function string.imorse(text)
	local t={}
	for m,sp in text:gmatch("([10]-)(000?)") do
		local c=imorse[m]
		if c then
			t[#t+1]=c
			if sp:match("000+") then
				t[#t+1]=" "
			end
		end
	end
	return table.concat(t)
end
local text=io.read"*a":upper():filter("[%c]+")
if arg[1]~="-d" then
	text=text:morse()
else
	text=text:filter("[^01]+")
	text=text:imorse()
end
print(text)
